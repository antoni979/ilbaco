{% comment %}
  Stilaro Virtual Try-On Button Block
  Este bloque permite a los clientes probar prendas virtualmente
{% endcomment %}

<div class="stilaro-vton-container" style="margin: {{ block.settings.margin_top }}px 0 {{ block.settings.margin_bottom }}px 0;">
  <button
    class="stilaro-vton-button"
    data-product-id="{{ product.id }}"
    data-variant-id="{{ product.selected_or_first_available_variant.id }}"
    data-product-title="{{ product.title | escape }}"
    data-product-image="{{ product.featured_image | image_url: width: 800 }}"
    data-product-price="{{ product.price | money }}"
    data-product-type="{{ product.type }}"
    style="
      background-color: {{ block.settings.button_bg_color }};
      color: {{ block.settings.button_text_color }};
      padding: {{ block.settings.button_padding }}px {{ block.settings.button_padding | times: 2 }}px;
      border-radius: {{ block.settings.border_radius }}px;
      border: none;
      font-size: {{ block.settings.font_size }}px;
      font-weight: 600;
      cursor: pointer;
      width: {% if block.settings.full_width %}100%{% else %}auto{% endif %};
      transition: opacity 0.2s ease;
    "
    onmouseover="this.style.opacity='0.85'"
    onmouseout="this.style.opacity='1'"
  >
    {{ block.settings.button_text }}
  </button>
</div>

<!-- Modal del Probador Virtual -->
<div id="stilaro-vton-modal" class="stilaro-vton-modal">
  <div class="stilaro-vton-modal-overlay"></div>
  <div class="stilaro-vton-modal-content" style="display: block !important; visibility: visible !important; opacity: 1 !important;">
    <button class="stilaro-vton-close">&times;</button>

    <div class="stilaro-vton-header">
      <h2>{{ block.settings.modal_title }}</h2>
      <p>{{ block.settings.modal_subtitle }}</p>
    </div>

    <!-- Zona de foto global (compartida entre pestaÃ±as) -->
    <div class="stilaro-global-photo-section" id="stilaro-global-photo-section">
      <div class="stilaro-global-upload-area" id="stilaro-global-upload-area">
        <input type="file" id="stilaro-global-photo-input" accept="image/*" style="display: none;">
        <div class="stilaro-global-upload-content">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="8" r="4"/>
            <path d="M20 21a8 8 0 0 0-16 0"/>
          </svg>
          <p>Sube tu foto</p>
          <span>Se usarÃ¡ para todas las funciones</span>
        </div>
      </div>

      <div class="stilaro-global-photo-preview" id="stilaro-global-photo-preview" style="display: none;">
        <img id="stilaro-global-photo-img" src="" alt="Tu foto">
        <button class="stilaro-global-photo-change" id="stilaro-global-photo-change">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
          Cambiar foto
        </button>
      </div>
    </div>

    <!-- PestaÃ±as -->
    <div class="stilaro-vton-tabs">
      <button class="stilaro-tab active" data-tab="single">Probar prenda</button>
      <button class="stilaro-tab" data-tab="sizing">Mi talla</button>
      <button class="stilaro-tab" data-tab="outfit">Completar look</button>
    </div>

    <div class="stilaro-vton-body">
      <!-- Paso 1: Probar prenda (usa foto global) -->
      <div class="stilaro-vton-step" id="stilaro-step-upload">
        <div class="stilaro-vton-product-preview">
          <img id="stilaro-product-image" src="" alt="Producto" width="60" height="60">
          <span id="stilaro-product-title"></span>
        </div>

        <!-- Mensaje si no hay foto -->
        <div class="stilaro-need-photo-msg" id="stilaro-need-photo-msg">
          <p>Sube tu foto arriba para probar esta prenda</p>
        </div>

        <!-- Input oculto para compatibilidad -->
        <input type="file" id="stilaro-photo-input" accept="image/*" style="display: none;">
        <div id="stilaro-upload-area" style="display: none;"></div>
        <img id="stilaro-user-preview" src="" alt="Tu foto" style="display: none;">

        <button id="stilaro-try-on-btn" class="stilaro-vton-primary-btn" style="display: none;">
          Probar prenda
        </button>
      </div>

      <!-- Paso 2: Resultado -->
      <div class="stilaro-vton-step" id="stilaro-step-result" style="display: none;">
        <div class="stilaro-vton-result">
          <img id="stilaro-result-image" src="" alt="Resultado" width="400" height="500">
        </div>
        <div class="stilaro-vton-actions">
          <button id="stilaro-download-btn" class="stilaro-vton-secondary-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Descargar
          </button>
          <button id="stilaro-retry-btn" class="stilaro-vton-secondary-btn">Otra foto</button>
          <button id="stilaro-add-cart-btn" class="stilaro-vton-primary-btn">AÃ±adir al carrito</button>
        </div>
      </div>

      <!-- Loading -->
      <div class="stilaro-vton-step" id="stilaro-step-loading" style="display: none;">
        <div class="stilaro-vton-spinner"></div>
        <p>Generando tu prueba virtual...</p>
        <div class="stilaro-progress-bar">
          <div class="stilaro-progress-fill" id="stilaro-progress-fill"></div>
        </div>
        <p class="stilaro-progress-text" id="stilaro-progress-text">0%</p>

        <!-- Consejos de moda animados -->
        <div class="stilaro-fashion-tips" id="stilaro-fashion-tips-single">
          <div class="fashion-tip-container">
            <span class="fashion-tip-icon">âœ¨</span>
            <p class="fashion-tip-text" id="stilaro-tip-text-single">Preparando tu look personalizado...</p>
          </div>
        </div>
      </div>

      <!-- ==================== -->
      <!-- TAB 3: CALCULADOR DE TALLAS -->
      <!-- ==================== -->

      <!-- Paso 1 Sizing: Info y botÃ³n (usa foto global) -->
      <div class="stilaro-vton-step stilaro-sizing-step" id="stilaro-sizing-upload" style="display: none;">
        <div class="stilaro-vton-product-preview">
          <img id="stilaro-sizing-product-image" src="" alt="Producto" width="60" height="60">
          <span id="stilaro-sizing-product-title"></span>
        </div>

        <div class="stilaro-sizing-intro">
          <p>Analizaremos tu complexiÃ³n con la foto que subiste para recomendarte la talla perfecta.</p>
        </div>

        <!-- Mensaje si no hay foto -->
        <div class="stilaro-need-photo-msg" id="stilaro-sizing-need-photo-msg">
          <p>Sube tu foto arriba para calcular tu talla</p>
        </div>

        <!-- Inputs ocultos para compatibilidad -->
        <input type="file" id="stilaro-sizing-photo-input" accept="image/*" style="display: none;">
        <div id="stilaro-sizing-upload-area" style="display: none;"></div>
        <img id="stilaro-sizing-user-preview" src="" alt="Tu foto" style="display: none;">

        <button id="stilaro-sizing-continue-btn" class="stilaro-vton-primary-btn" style="display: none;">
          Calcular mi talla
        </button>
      </div>

      <!-- Paso 2 Sizing: Formulario de datos -->
      <div class="stilaro-vton-step stilaro-sizing-step" id="stilaro-sizing-form" style="display: none;">
        <div class="stilaro-sizing-form-content">
          <h3>CuÃ©ntanos un poco mÃ¡s</h3>

          <div class="stilaro-sizing-field">
            <label for="stilaro-sizing-height">Altura (opcional)</label>
            <div class="stilaro-sizing-input-group">
              <input type="number" id="stilaro-sizing-height" placeholder="175" min="100" max="250">
              <span class="stilaro-sizing-unit">cm</span>
            </div>
          </div>

          <div class="stilaro-sizing-field">
            <label>Â¿CÃ³mo te gusta que te quede la ropa?</label>
            <div class="stilaro-sizing-options" id="stilaro-sizing-fit">
              <button type="button" class="stilaro-sizing-option" data-value="ajustado">
                <span class="option-icon">ðŸ‘”</span>
                <span class="option-label">Ajustado</span>
              </button>
              <button type="button" class="stilaro-sizing-option active" data-value="regular">
                <span class="option-icon">ðŸ‘•</span>
                <span class="option-label">Regular</span>
              </button>
              <button type="button" class="stilaro-sizing-option" data-value="holgado">
                <span class="option-icon">ðŸ§¥</span>
                <span class="option-label">Holgado</span>
              </button>
            </div>
          </div>

          <div class="stilaro-sizing-field">
            <label for="stilaro-sizing-brand">Â¿QuÃ© tipo de tienda usas de referencia?</label>
            <select id="stilaro-sizing-brand">
              <option value="grandes_almacenes">Grandes Almacenes</option>
              <option value="moda_economica">Moda EconÃ³mica (tallaje amplio)</option>
              <option value="moda_estandar">Moda EstÃ¡ndar</option>
              <option value="moda_joven">Moda Joven</option>
              <option value="moda_premium">Moda Premium (tallaje pequeÃ±o)</option>
              <option value="moda_asiatica">Moda AsiÃ¡tica (tallaje grande)</option>
              <option value="deportivo">Tiendas Deportivas</option>
              <option value="other">Otra</option>
            </select>
          </div>

          <div class="stilaro-sizing-field">
            <label>Â¿QuÃ© talla sueles usar en esa marca?</label>
            <div class="stilaro-sizing-options stilaro-sizing-sizes" id="stilaro-sizing-reference">
              <button type="button" class="stilaro-sizing-option" data-value="XS">XS</button>
              <button type="button" class="stilaro-sizing-option" data-value="S">S</button>
              <button type="button" class="stilaro-sizing-option active" data-value="M">M</button>
              <button type="button" class="stilaro-sizing-option" data-value="L">L</button>
              <button type="button" class="stilaro-sizing-option" data-value="XL">XL</button>
              <button type="button" class="stilaro-sizing-option" data-value="XXL">XXL</button>
            </div>
          </div>
        </div>

        <button id="stilaro-sizing-analyze-btn" class="stilaro-vton-primary-btn">
          Calcular mi talla
        </button>
      </div>

      <!-- Paso 3 Sizing: Loading -->
      <div class="stilaro-vton-step stilaro-sizing-step" id="stilaro-sizing-loading" style="display: none;">
        <div class="stilaro-vton-spinner"></div>
        <p>Analizando tu complexiÃ³n...</p>
        <div class="stilaro-progress-bar">
          <div class="stilaro-progress-fill" id="stilaro-sizing-progress-fill"></div>
        </div>
        <p class="stilaro-progress-text" id="stilaro-sizing-progress-text">0%</p>
      </div>

      <!-- Paso 4 Sizing: Resultado -->
      <div class="stilaro-vton-step stilaro-sizing-step" id="stilaro-sizing-result" style="display: none;">
        <div class="stilaro-sizing-result-card">
          <div class="stilaro-sizing-result-header">
            <span class="sizing-result-icon">ðŸ‘•</span>
            <h3>Tu talla recomendada</h3>
          </div>

          <div class="stilaro-sizing-recommended">
            <span class="sizing-main-size" id="stilaro-recommended-size">M</span>
            <span class="sizing-alt-size" id="stilaro-alt-size">TambiÃ©n podrÃ­as usar L</span>
          </div>

          <div class="stilaro-sizing-confidence" id="stilaro-sizing-confidence">
            <span class="confidence-label">Confianza:</span>
            <div class="confidence-bar">
              <div class="confidence-fill" id="stilaro-confidence-fill"></div>
            </div>
            <span class="confidence-text" id="stilaro-confidence-text">Alta</span>
          </div>

          <div class="stilaro-sizing-details" id="stilaro-sizing-details">
            <!-- Se rellenarÃ¡ con JS -->
          </div>

          <div class="stilaro-sizing-tip" id="stilaro-sizing-tip">
            <!-- Se rellenarÃ¡ con JS -->
          </div>
        </div>

        <div class="stilaro-vton-actions">
          <button id="stilaro-sizing-retry-btn" class="stilaro-vton-secondary-btn">Recalcular</button>
          <button id="stilaro-sizing-tryon-btn" class="stilaro-vton-primary-btn">Probar esta talla</button>
        </div>
      </div>

      <!-- ==================== -->
      <!-- TAB 2: COMPLETAR LOOK -->
      <!-- ==================== -->

      <!-- Paso Outfit: ConfirmaciÃ³n (usa foto global) -->
      <div class="stilaro-vton-step stilaro-outfit-step" id="stilaro-outfit-upload" style="display: none;">
        <div class="stilaro-outfit-selected-summary" id="stilaro-outfit-selected-summary">
          <p><strong>Tu outfit seleccionado:</strong></p>
          <div class="outfit-preview" id="stilaro-outfit-upload-preview"></div>
        </div>

        <!-- Mensaje si no hay foto -->
        <div class="stilaro-need-photo-msg" id="stilaro-outfit-need-photo-msg">
          <p>Sube tu foto arriba para probarte el outfit</p>
        </div>

        <!-- Inputs ocultos para compatibilidad -->
        <input type="file" id="stilaro-outfit-photo-input" accept="image/*" style="display: none;">
        <div id="stilaro-outfit-upload-area" style="display: none;"></div>
        <img id="stilaro-outfit-user-preview" src="" alt="Tu foto" style="display: none;">

        <button id="stilaro-outfit-continue-btn" class="stilaro-vton-primary-btn" style="display: none;">
          Generar look
        </button>
      </div>

      <!-- Paso 2 Outfit: Recomendaciones -->
      <div class="stilaro-vton-step stilaro-outfit-step" id="stilaro-outfit-recommendations" style="display: none;">
        <div class="stilaro-outfit-summary" id="stilaro-outfit-summary">
          <strong>Tu outfit:</strong>
          <div class="outfit-preview" id="stilaro-outfit-preview"></div>
        </div>

        <div class="stilaro-recommendations-header">
          <h3>Completa tu look</h3>
          <p>Selecciona prendas que combinen</p>
        </div>

        <div class="stilaro-recommendations-grid" id="stilaro-recommendations-grid">
          <p class="stilaro-loading-text">Buscando prendas que combinen...</p>
        </div>

        <div class="stilaro-recommendations-actions">
          <button id="stilaro-skip-btn" class="stilaro-vton-secondary-btn">Solo esta prenda</button>
          <button id="stilaro-outfit-tryon-btn" class="stilaro-vton-primary-btn">Probar outfit</button>
        </div>
      </div>

      <!-- Paso 3 Outfit: Loading -->
      <div class="stilaro-vton-step stilaro-outfit-step" id="stilaro-outfit-loading" style="display: none;">
        <div class="stilaro-vton-spinner"></div>
        <p>Generando tu look completo...</p>
        <div class="stilaro-progress-bar">
          <div class="stilaro-progress-fill" id="stilaro-outfit-progress-fill"></div>
        </div>
        <p class="stilaro-progress-text" id="stilaro-outfit-progress-text">0%</p>

        <!-- Consejos de moda animados -->
        <div class="stilaro-fashion-tips" id="stilaro-fashion-tips">
          <div class="fashion-tip-container">
            <span class="fashion-tip-icon">âœ¨</span>
            <p class="fashion-tip-text" id="stilaro-tip-text">Preparando tu look personalizado...</p>
          </div>
        </div>
      </div>

      <!-- Paso 4 Outfit: Resultado -->
      <div class="stilaro-vton-step stilaro-outfit-step" id="stilaro-outfit-result" style="display: none;">
        <div class="stilaro-vton-result">
          <img id="stilaro-outfit-result-image" src="" alt="Resultado">
        </div>
        <div class="stilaro-outfit-items-list" id="stilaro-outfit-items-list"></div>
        <div class="stilaro-vton-actions">
          <button id="stilaro-outfit-download-btn" class="stilaro-vton-secondary-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 4px;">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Descargar
          </button>
          <button id="stilaro-outfit-retry-btn" class="stilaro-vton-secondary-btn">Cambiar look</button>
          <button id="stilaro-outfit-addall-btn" class="stilaro-vton-primary-btn">AÃ±adir todo al carrito</button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* ==================== */
  /* CSS VARIABLES - ADAPTIVE TO THEME */
  /* ==================== */
  .stilaro-vton-modal {
    /* Primary color from settings */
    --stilaro-primary: {{ block.settings.button_bg_color }};
    --stilaro-primary-text: {{ block.settings.button_text_color }};

    /* Adaptive colors - inherit from Shopify theme or use smart fallbacks */
    /* Background: try theme vars, fallback to computed from page background */
    --stilaro-bg: var(--color-background, var(--color-base-background-1, #ffffff));
    --stilaro-bg-secondary: var(--color-background-2, var(--color-base-background-2, rgba(128, 128, 128, 0.06)));

    /* Text colors: inherit from theme */
    --stilaro-text: var(--color-foreground, var(--color-base-text, currentColor));
    --stilaro-text-muted: var(--color-foreground-muted, color-mix(in srgb, var(--stilaro-text) 60%, transparent));
    --stilaro-text-subtle: var(--color-foreground-subtle, color-mix(in srgb, var(--stilaro-text) 45%, transparent));

    /* Border: inherit from theme */
    --stilaro-border: var(--color-border, color-mix(in srgb, var(--stilaro-text) 15%, transparent));
    --stilaro-border-strong: var(--color-border-strong, color-mix(in srgb, var(--stilaro-text) 25%, transparent));

    /* Adaptive grays using color-mix for theme compatibility */
    --stilaro-gray-50: color-mix(in srgb, var(--stilaro-text) 3%, var(--stilaro-bg));
    --stilaro-gray-100: color-mix(in srgb, var(--stilaro-text) 6%, var(--stilaro-bg));
    --stilaro-gray-200: color-mix(in srgb, var(--stilaro-text) 12%, var(--stilaro-bg));
    --stilaro-gray-300: color-mix(in srgb, var(--stilaro-text) 20%, var(--stilaro-bg));
    --stilaro-gray-400: color-mix(in srgb, var(--stilaro-text) 40%, var(--stilaro-bg));
    --stilaro-gray-500: color-mix(in srgb, var(--stilaro-text) 55%, var(--stilaro-bg));
    --stilaro-gray-600: color-mix(in srgb, var(--stilaro-text) 70%, var(--stilaro-bg));
    --stilaro-gray-700: color-mix(in srgb, var(--stilaro-text) 80%, var(--stilaro-bg));
    --stilaro-gray-800: color-mix(in srgb, var(--stilaro-text) 90%, var(--stilaro-bg));

    /* Design tokens */
    --stilaro-radius-sm: 6px;
    --stilaro-radius-md: 8px;
    --stilaro-radius-lg: 12px;
    --stilaro-radius-xl: 16px;
    --stilaro-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    --stilaro-transition: 0.2s ease;

    /* Color scheme detection */
    color-scheme: light dark;
  }

  .stilaro-vton-container {
    max-width: none !important;
  }

  /* ==================== */
  /* MODAL BASE */
  /* ==================== */
  .stilaro-vton-modal {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    height: 100dvh !important;
    z-index: 999999 !important;
    max-width: none !important;
    margin: 0 !important;
    padding: 0 !important;
    display: none;
    align-items: center !important;
    justify-content: center !important;
    box-sizing: border-box !important;
    /* Reset any inherited styles that could interfere */
    transform: none !important;
    float: none !important;
    clear: both !important;
  }

  /* Active state - show centered */
  .stilaro-vton-modal.stilaro-active {
    display: flex !important;
  }

  /* Forzar visibilidad del contenido con selector de alta especificidad */
  #stilaro-vton-modal.stilaro-active > .stilaro-vton-modal-content {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

  /* Forzar visibilidad de elementos internos crÃ­ticos */
  #stilaro-vton-modal.stilaro-active .stilaro-vton-header {
    display: block !important;
    visibility: visible !important;
  }

  #stilaro-vton-modal.stilaro-active .stilaro-vton-tabs {
    display: flex !important;
    visibility: visible !important;
  }

  #stilaro-vton-modal.stilaro-active .stilaro-vton-body {
    display: block !important;
    visibility: visible !important;
  }

  #stilaro-vton-modal.stilaro-active .stilaro-vton-close {
    display: flex !important;
    visibility: visible !important;
  }

  .stilaro-vton-modal-overlay {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    height: 100dvh !important;
    background-color: rgba(0, 0, 0, 0.5) !important;
    pointer-events: auto !important;
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    z-index: 1 !important;
  }

  /* Content wrapper for centering */
  .stilaro-vton-modal > .stilaro-vton-modal-content {
    z-index: 2 !important;
  }

  .stilaro-vton-modal-content {
    display: block !important;
    position: relative !important;
    /* Fallback sÃ³lido por si las variables CSS no funcionan */
    background: #ffffff !important;
    background: var(--stilaro-bg, #ffffff) !important;
    color: #121212 !important;
    color: var(--stilaro-text, #121212) !important;
    border-radius: var(--stilaro-radius-xl) !important;
    width: calc(100% - 32px) !important;
    max-width: 480px !important;
    min-height: 400px !important;
    max-height: calc(100vh - 40px) !important;
    max-height: calc(100dvh - 40px) !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    padding: clamp(16px, 4vw, 24px) !important;
    scrollbar-width: thin;
    scrollbar-color: var(--stilaro-gray-300) transparent;
    box-sizing: border-box !important;
    margin: auto !important;
    transition: max-width 0.3s ease, max-height 0.3s ease;
    pointer-events: auto !important;
    box-shadow: var(--stilaro-shadow) !important;
    /* Ensure it stays centered even if flex fails */
    flex-shrink: 0 !important;
  }

  /* Scrollbar personalizado */
  .stilaro-vton-modal-content::-webkit-scrollbar {
    width: 6px;
  }

  .stilaro-vton-modal-content::-webkit-scrollbar-track {
    background: transparent;
  }

  .stilaro-vton-modal-content::-webkit-scrollbar-thumb {
    background-color: var(--stilaro-gray-300);
    border-radius: 3px;
  }

  /* Modal expandido para outfit */
  .stilaro-vton-modal.outfit-mode .stilaro-vton-modal-content {
    max-width: 580px !important;
  }

  /* Modal expandido para sizing */
  .stilaro-vton-modal.sizing-mode .stilaro-vton-modal-content {
    max-width: 480px !important;
  }

  /* ==================== */
  /* BOTON CERRAR */
  /* ==================== */
  .stilaro-vton-close {
    position: absolute;
    top: clamp(8px, 2vw, 12px);
    right: clamp(8px, 2vw, 12px);
    width: clamp(32px, 8vw, 36px);
    height: clamp(32px, 8vw, 36px);
    background: var(--stilaro-gray-100);
    border: 1px solid var(--stilaro-border);
    border-radius: 50%;
    font-size: clamp(18px, 4vw, 22px);
    font-weight: 300;
    cursor: pointer;
    color: var(--stilaro-text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--stilaro-transition);
    z-index: 10;
    line-height: 1;
  }

  .stilaro-vton-close:hover {
    background: var(--stilaro-gray-200);
    color: var(--stilaro-text);
    transform: scale(1.05);
  }

  .stilaro-vton-close:active {
    transform: scale(0.95);
  }

  /* ==================== */
  /* HEADER */
  /* ==================== */
  .stilaro-vton-header {
    display: block !important;
    text-align: center;
    margin-bottom: clamp(16px, 4vw, 24px);
    padding-right: 40px;
  }

  .stilaro-vton-header h2 {
    margin: 0 0 6px 0;
    font-size: clamp(18px, 4.5vw, 22px);
    font-weight: 600;
    color: var(--stilaro-text);
    line-height: 1.3;
  }

  .stilaro-vton-header p {
    margin: 0;
    color: var(--stilaro-text-muted);
    font-size: clamp(12px, 3vw, 14px);
    line-height: 1.4;
  }

  /* ==================== */
  /* GLOBAL PHOTO SECTION */
  /* ==================== */
  .stilaro-global-photo-section {
    margin-bottom: clamp(16px, 4vw, 20px);
  }

  .stilaro-global-upload-area {
    border: 2px dashed var(--stilaro-primary);
    border-radius: var(--stilaro-radius-lg);
    padding: clamp(16px, 4vw, 20px);
    text-align: center;
    cursor: pointer;
    transition: all var(--stilaro-transition);
    background: linear-gradient(135deg, var(--stilaro-gray-50) 0%, rgba(var(--stilaro-primary), 0.05) 100%);
  }

  .stilaro-global-upload-area:hover {
    background: var(--stilaro-gray-100);
    border-style: solid;
  }

  .stilaro-global-upload-content svg {
    color: var(--stilaro-primary);
    margin-bottom: clamp(6px, 1.5vw, 8px);
  }

  .stilaro-global-upload-content p {
    margin: 0 0 2px 0;
    font-weight: 600;
    font-size: clamp(14px, 3.5vw, 16px);
    color: var(--stilaro-text);
  }

  .stilaro-global-upload-content span {
    color: var(--stilaro-text-muted);
    font-size: clamp(11px, 2.8vw, 12px);
  }

  .stilaro-global-photo-preview {
    display: flex;
    align-items: center;
    gap: clamp(12px, 3vw, 16px);
    padding: clamp(10px, 2.5vw, 12px);
    background: var(--stilaro-gray-50);
    border-radius: var(--stilaro-radius-lg);
    border: 2px solid var(--stilaro-primary);
  }

  .stilaro-global-photo-preview img {
    width: clamp(60px, 15vw, 80px);
    height: clamp(80px, 20vw, 100px);
    object-fit: cover;
    border-radius: var(--stilaro-radius-md);
    flex-shrink: 0;
  }

  .stilaro-global-photo-change {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 16px);
    background: var(--stilaro-bg);
    border: 1px solid var(--stilaro-border);
    border-radius: var(--stilaro-radius-md);
    font-size: clamp(12px, 3vw, 13px);
    font-weight: 500;
    color: var(--stilaro-text);
    cursor: pointer;
    transition: all var(--stilaro-transition);
    margin-left: auto;
  }

  .stilaro-global-photo-change:hover {
    background: var(--stilaro-gray-100);
    border-color: var(--stilaro-primary);
  }

  .stilaro-global-photo-change svg {
    color: var(--stilaro-primary);
  }

  /* ==================== */
  /* NEED PHOTO MESSAGE */
  /* ==================== */
  .stilaro-need-photo-msg {
    text-align: center;
    padding: clamp(20px, 5vw, 30px);
    background: var(--stilaro-gray-50);
    border-radius: var(--stilaro-radius-lg);
    border: 2px dashed var(--stilaro-border);
  }

  .stilaro-need-photo-msg p {
    margin: 0;
    color: var(--stilaro-text-muted);
    font-size: clamp(13px, 3.5vw, 15px);
  }

  /* ==================== */
  /* TABS */
  /* ==================== */
  .stilaro-vton-tabs {
    display: flex !important;
    gap: 0;
    margin-bottom: clamp(16px, 4vw, 24px);
    border-bottom: 2px solid var(--stilaro-border);
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .stilaro-vton-tabs::-webkit-scrollbar {
    display: none;
  }

  .stilaro-tab {
    flex: 1;
    min-width: max-content;
    padding: clamp(10px, 2.5vw, 12px) clamp(8px, 2vw, 16px);
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 500;
    color: var(--stilaro-text-muted);
    cursor: pointer;
    transition: all var(--stilaro-transition);
    white-space: nowrap;
  }

  .stilaro-tab:hover {
    color: var(--stilaro-text);
  }

  .stilaro-tab.active {
    color: var(--stilaro-primary);
    border-bottom-color: var(--stilaro-primary);
  }

  /* ==================== */
  /* BODY */
  /* ==================== */
  .stilaro-vton-body {
    display: block !important;
    min-height: 180px;
  }

  /* ==================== */
  /* PRODUCT PREVIEW */
  /* ==================== */
  .stilaro-vton-product-preview {
    display: flex;
    align-items: center;
    gap: clamp(8px, 2vw, 12px);
    padding: clamp(10px, 2.5vw, 12px);
    background: var(--stilaro-gray-50);
    border-radius: var(--stilaro-radius-md);
    margin-bottom: clamp(12px, 3vw, 16px);
  }

  .stilaro-vton-product-preview img {
    width: clamp(50px, 12vw, 60px);
    height: clamp(50px, 12vw, 60px);
    object-fit: cover;
    border-radius: var(--stilaro-radius-md);
    flex-shrink: 0;
  }

  .stilaro-vton-product-preview span {
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 500;
    color: var(--stilaro-text);
    line-height: 1.3;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  /* ==================== */
  /* UPLOAD AREA */
  /* ==================== */
  .stilaro-vton-upload-area {
    border: 2px dashed var(--stilaro-border-strong);
    border-radius: var(--stilaro-radius-lg);
    padding: clamp(24px, 6vw, 40px) clamp(16px, 4vw, 20px);
    text-align: center;
    cursor: pointer;
    transition: all var(--stilaro-transition);
    background: var(--stilaro-gray-50);
  }

  .stilaro-vton-upload-area:hover {
    border-color: var(--stilaro-primary);
    background: var(--stilaro-gray-100);
  }

  .stilaro-vton-upload-content svg {
    color: var(--stilaro-text-subtle);
    margin-bottom: clamp(8px, 2vw, 12px);
    width: clamp(36px, 10vw, 48px);
    height: clamp(36px, 10vw, 48px);
  }

  .stilaro-vton-upload-content p {
    margin: 0 0 4px 0;
    font-weight: 500;
    font-size: clamp(13px, 3.5vw, 15px);
    color: var(--stilaro-text);
  }

  .stilaro-vton-upload-content span {
    color: var(--stilaro-text-subtle);
    font-size: clamp(11px, 2.8vw, 12px);
  }

  /* ==================== */
  /* USER PREVIEW */
  /* ==================== */
  #stilaro-user-preview,
  #stilaro-outfit-user-preview,
  #stilaro-sizing-user-preview {
    width: 100%;
    max-height: clamp(200px, 45vw, 300px);
    object-fit: contain;
    border-radius: var(--stilaro-radius-md);
    margin-bottom: clamp(12px, 3vw, 16px);
  }

  /* ==================== */
  /* BUTTONS */
  /* ==================== */
  .stilaro-vton-primary-btn {
    width: 100%;
    padding: clamp(12px, 3vw, 14px);
    background: var(--stilaro-primary);
    color: var(--stilaro-primary-text);
    border: none;
    border-radius: var(--stilaro-radius-md);
    font-size: clamp(14px, 3.5vw, 16px);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--stilaro-transition);
    touch-action: manipulation;
  }

  .stilaro-vton-primary-btn:hover {
    opacity: 0.9;
  }

  .stilaro-vton-primary-btn:active {
    transform: scale(0.98);
  }

  .stilaro-vton-secondary-btn {
    padding: clamp(10px, 2.5vw, 14px) clamp(12px, 3vw, 16px);
    background: var(--stilaro-gray-100);
    color: var(--stilaro-text);
    border: 1px solid var(--stilaro-border);
    border-radius: var(--stilaro-radius-md);
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--stilaro-transition);
    touch-action: manipulation;
    white-space: nowrap;
  }

  .stilaro-vton-secondary-btn:hover {
    background: var(--stilaro-gray-200);
  }

  .stilaro-vton-secondary-btn:active {
    transform: scale(0.98);
  }

  /* ==================== */
  /* RESULT */
  /* ==================== */
  .stilaro-vton-result img {
    width: 100%;
    max-height: clamp(280px, 50vw, 400px);
    object-fit: contain;
    border-radius: var(--stilaro-radius-md);
    margin-bottom: clamp(12px, 3vw, 16px);
  }

  /* ==================== */
  /* ACTIONS */
  /* ==================== */
  .stilaro-vton-actions {
    display: flex;
    flex-wrap: wrap;
    gap: clamp(6px, 1.5vw, 8px);
  }

  .stilaro-vton-actions .stilaro-vton-primary-btn {
    flex: 1;
    min-width: 140px;
  }

  .stilaro-vton-actions .stilaro-vton-secondary-btn {
    flex: 0 0 auto;
  }

  /* ==================== */
  /* LOADING */
  /* ==================== */
  .stilaro-vton-spinner {
    width: clamp(40px, 10vw, 48px);
    height: clamp(40px, 10vw, 48px);
    border: 4px solid var(--stilaro-gray-100);
    border-top: 4px solid var(--stilaro-primary);
    border-radius: 50%;
    animation: stilaro-spin 1s linear infinite;
    margin: clamp(30px, 8vw, 40px) auto;
  }

  @keyframes stilaro-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  #stilaro-step-loading,
  #stilaro-sizing-loading,
  #stilaro-outfit-loading {
    text-align: center;
    padding: clamp(24px, 6vw, 40px) 0;
  }

  #stilaro-step-loading p,
  #stilaro-sizing-loading p,
  #stilaro-outfit-loading p {
    color: var(--stilaro-text-muted);
    margin-top: clamp(12px, 3vw, 16px);
    font-size: clamp(13px, 3.5vw, 15px);
  }

  .stilaro-progress-bar {
    width: 100%;
    height: clamp(6px, 1.5vw, 8px);
    background: var(--stilaro-gray-100);
    border-radius: 4px;
    overflow: hidden;
    margin: clamp(16px, 4vw, 24px) 0 clamp(6px, 1.5vw, 8px) 0;
  }

  .stilaro-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--stilaro-primary) 0%, var(--stilaro-primary) 100%);
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 4px;
  }

  .stilaro-progress-text {
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 600;
    color: var(--stilaro-primary);
  }

  /* ==================== */
  /* OUTFIT TAB STYLES */
  /* ==================== */
  .stilaro-outfit-summary,
  .stilaro-outfit-selected-summary {
    background: var(--stilaro-gray-50);
    border-radius: var(--stilaro-radius-lg);
    padding: clamp(10px, 2.5vw, 14px);
    margin-bottom: clamp(14px, 3.5vw, 20px);
    text-align: center;
  }

  .stilaro-outfit-summary strong,
  .stilaro-outfit-selected-summary p {
    display: block;
    margin-bottom: clamp(6px, 1.5vw, 10px);
    font-size: clamp(12px, 3vw, 14px);
    color: var(--stilaro-text-muted);
  }

  .outfit-preview,
  #stilaro-outfit-upload-preview {
    display: flex;
    justify-content: center;
    gap: clamp(6px, 1.5vw, 10px);
    flex-wrap: wrap;
  }

  .outfit-preview img,
  #stilaro-outfit-upload-preview img {
    width: clamp(45px, 12vw, 55px);
    height: clamp(58px, 15vw, 72px);
    object-fit: cover;
    border-radius: var(--stilaro-radius-sm);
    border: 2px solid var(--stilaro-primary);
  }

  .stilaro-recommendations-header {
    text-align: center;
    margin-bottom: clamp(12px, 3vw, 16px);
  }

  .stilaro-recommendations-header h3 {
    margin: 0 0 clamp(4px, 1vw, 6px) 0;
    font-size: clamp(16px, 4vw, 18px);
    font-weight: 600;
    color: var(--stilaro-text);
  }

  .stilaro-recommendations-header p {
    margin: 0;
    color: var(--stilaro-text-muted);
    font-size: clamp(12px, 3vw, 14px);
  }

  .stilaro-recommendations-grid {
    max-height: clamp(220px, 40vh, 300px);
    overflow-y: auto;
    overflow-x: hidden;
    margin-bottom: clamp(12px, 3vw, 16px);
    padding-right: 4px;
    scrollbar-width: thin;
    scrollbar-color: var(--stilaro-gray-300) transparent;
  }

  .stilaro-recommendations-grid::-webkit-scrollbar {
    width: 4px;
  }

  .stilaro-recommendations-grid::-webkit-scrollbar-thumb {
    background-color: var(--stilaro-gray-300);
    border-radius: 2px;
  }

  .stilaro-style-analysis {
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    border: 1px solid #fcd34d;
    border-left: 3px solid #f59e0b;
    padding: clamp(8px, 2vw, 10px) clamp(10px, 2.5vw, 12px);
    margin-bottom: clamp(10px, 2.5vw, 14px);
    border-radius: 0 var(--stilaro-radius-sm) var(--stilaro-radius-sm) 0;
    font-size: clamp(11px, 2.8vw, 12.5px);
    line-height: 1.45;
    color: #92400e;
    display: flex;
    align-items: flex-start;
    gap: clamp(6px, 1.5vw, 8px);
  }

  .stilaro-style-analysis::before {
    content: "ðŸ’¡";
    font-size: clamp(12px, 3vw, 14px);
    flex-shrink: 0;
  }

  .stilaro-loading-text {
    text-align: center;
    color: var(--stilaro-text-muted);
    padding: clamp(16px, 4vw, 20px);
    font-size: clamp(13px, 3.5vw, 14px);
  }

  .stilaro-recommendation-category {
    margin-bottom: clamp(14px, 3.5vw, 20px);
  }

  .stilaro-recommendation-category h4 {
    margin: 0 0 clamp(8px, 2vw, 10px) 0;
    font-size: clamp(11px, 2.8vw, 13px);
    color: var(--stilaro-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
    text-align: center;
  }

  .stilaro-recommendation-items {
    display: flex;
    gap: clamp(8px, 2vw, 12px);
    overflow-x: auto;
    padding-bottom: 10px;
    justify-content: flex-start;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: var(--stilaro-gray-200) transparent;
  }

  .stilaro-recommendation-items::-webkit-scrollbar {
    height: 4px;
  }

  .stilaro-recommendation-items::-webkit-scrollbar-thumb {
    background-color: var(--stilaro-gray-200);
    border-radius: 2px;
  }

  .stilaro-recommendation-item {
    flex: 0 0 clamp(85px, 22vw, 100px);
    cursor: pointer;
    border: 2px solid var(--stilaro-border);
    border-radius: var(--stilaro-radius-md);
    padding: clamp(4px, 1vw, 6px);
    transition: all var(--stilaro-transition);
    position: relative;
    background: var(--stilaro-bg);
  }

  .stilaro-recommendation-item:hover {
    border-color: var(--stilaro-border-strong);
  }

  .stilaro-recommendation-item.selected {
    border-color: var(--stilaro-primary);
    background: rgba(0,0,0,0.02);
  }

  .stilaro-recommendation-item img {
    width: 100%;
    aspect-ratio: 3/4;
    object-fit: cover;
    border-radius: 4px;
  }

  .stilaro-recommendation-item .item-title {
    display: block;
    font-size: clamp(9px, 2.3vw, 10px);
    margin-top: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--stilaro-text);
    font-weight: 500;
  }

  .stilaro-recommendation-item .item-reason {
    display: block;
    font-size: clamp(8px, 2vw, 9px);
    color: var(--stilaro-text-subtle);
    margin-top: 2px;
    line-height: 1.2;
    font-style: italic;
  }

  .stilaro-recommendation-item .item-score {
    position: absolute;
    top: clamp(4px, 1vw, 6px);
    left: clamp(4px, 1vw, 6px);
    background: var(--stilaro-primary);
    color: var(--stilaro-primary-text);
    font-size: clamp(8px, 2vw, 9px);
    padding: 2px 5px;
    border-radius: 3px;
    font-weight: 600;
  }

  .stilaro-recommendation-item .item-check {
    position: absolute;
    top: clamp(4px, 1vw, 6px);
    right: clamp(4px, 1vw, 6px);
    width: clamp(18px, 4.5vw, 20px);
    height: clamp(18px, 4.5vw, 20px);
    background: var(--stilaro-primary);
    color: var(--stilaro-primary-text);
    border-radius: 50%;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: clamp(9px, 2.3vw, 11px);
  }

  .stilaro-recommendation-item.selected .item-check {
    display: flex;
  }

  .stilaro-recommendations-actions {
    display: flex;
    gap: clamp(8px, 2vw, 12px);
    padding-top: clamp(12px, 3vw, 16px);
    border-top: 1px solid var(--stilaro-border);
    background: var(--stilaro-bg);
    margin-top: clamp(12px, 3vw, 16px);
  }

  .stilaro-recommendations-actions .stilaro-vton-primary-btn {
    flex: 1;
  }

  .stilaro-outfit-items-list {
    display: flex;
    gap: clamp(6px, 1.5vw, 8px);
    justify-content: center;
    margin-bottom: clamp(12px, 3vw, 16px);
    flex-wrap: wrap;
  }

  .stilaro-outfit-items-list .outfit-item {
    text-align: center;
    font-size: clamp(10px, 2.5vw, 11px);
    color: var(--stilaro-text-muted);
  }

  .stilaro-outfit-items-list .outfit-item img {
    width: clamp(38px, 10vw, 45px);
    height: clamp(50px, 13vw, 60px);
    object-fit: cover;
    border-radius: 4px;
    border: 1px solid var(--stilaro-border-strong);
    display: block;
    margin-bottom: 4px;
  }

  /* ==================== */
  /* SIZING TAB STYLES */
  /* ==================== */
  .stilaro-sizing-intro {
    text-align: center;
    margin-bottom: clamp(12px, 3vw, 16px);
    padding: clamp(10px, 2.5vw, 12px);
    background: var(--stilaro-gray-50);
    border-radius: var(--stilaro-radius-md);
  }

  .stilaro-sizing-intro p {
    margin: 0;
    font-size: clamp(12px, 3vw, 13px);
    color: var(--stilaro-text-muted);
    line-height: 1.5;
  }

  .stilaro-sizing-form-content {
    padding: 0 clamp(2px, 0.5vw, 4px);
  }

  .stilaro-sizing-form-content h3 {
    text-align: center;
    margin: 0 0 clamp(16px, 4vw, 20px) 0;
    font-size: clamp(16px, 4vw, 18px);
    font-weight: 600;
    color: var(--stilaro-text);
  }

  .stilaro-sizing-field {
    margin-bottom: clamp(16px, 4vw, 20px);
  }

  .stilaro-sizing-field label {
    display: block;
    font-size: clamp(12px, 3vw, 13px);
    font-weight: 500;
    color: var(--stilaro-text);
    margin-bottom: clamp(6px, 1.5vw, 8px);
  }

  .stilaro-sizing-input-group {
    display: flex;
    align-items: center;
    gap: clamp(6px, 1.5vw, 8px);
  }

  .stilaro-sizing-input-group input {
    flex: 1;
    padding: clamp(10px, 2.5vw, 12px);
    border: 1px solid var(--stilaro-border-strong);
    border-radius: var(--stilaro-radius-md);
    font-size: 16px; /* Prevents zoom on iOS */
    text-align: center;
    background: var(--stilaro-bg);
    color: var(--stilaro-text);
  }

  .stilaro-sizing-input-group input:focus {
    outline: none;
    border-color: var(--stilaro-primary);
  }

  .stilaro-sizing-unit {
    font-size: clamp(13px, 3.5vw, 14px);
    color: var(--stilaro-text-muted);
    font-weight: 500;
  }

  .stilaro-sizing-field select {
    width: 100%;
    padding: clamp(10px, 2.5vw, 12px);
    border: 1px solid var(--stilaro-border-strong);
    border-radius: var(--stilaro-radius-md);
    font-size: 16px; /* Prevents zoom on iOS */
    background: var(--stilaro-bg);
    color: var(--stilaro-text);
    cursor: pointer;
  }

  .stilaro-sizing-field select:focus {
    outline: none;
    border-color: var(--stilaro-primary);
  }

  .stilaro-sizing-options {
    display: flex;
    gap: clamp(6px, 1.5vw, 8px);
    flex-wrap: wrap;
    justify-content: center;
  }

  .stilaro-sizing-option {
    flex: 1;
    min-width: clamp(60px, 16vw, 70px);
    max-width: clamp(85px, 22vw, 100px);
    padding: clamp(10px, 2.5vw, 12px) clamp(6px, 1.5vw, 8px);
    border: 2px solid var(--stilaro-border);
    border-radius: var(--stilaro-radius-md);
    background: var(--stilaro-bg);
    cursor: pointer;
    transition: all var(--stilaro-transition);
    text-align: center;
  }

  .stilaro-sizing-option:hover {
    border-color: var(--stilaro-border-strong);
  }

  .stilaro-sizing-option.active {
    border-color: var(--stilaro-primary);
    background: var(--stilaro-gray-50);
  }

  .stilaro-sizing-option .option-icon {
    display: block;
    font-size: clamp(18px, 4.5vw, 20px);
    margin-bottom: 4px;
  }

  .stilaro-sizing-option .option-label {
    display: block;
    font-size: clamp(10px, 2.5vw, 11px);
    font-weight: 500;
    color: var(--stilaro-text);
  }

  .stilaro-sizing-sizes .stilaro-sizing-option {
    min-width: clamp(40px, 10vw, 45px);
    max-width: clamp(50px, 13vw, 55px);
    padding: clamp(8px, 2vw, 10px) clamp(4px, 1vw, 6px);
    font-size: clamp(12px, 3vw, 14px);
    font-weight: 600;
  }

  /* Resultado de tallas */
  .stilaro-sizing-result-card {
    background: linear-gradient(135deg, var(--stilaro-gray-50) 0%, var(--stilaro-bg) 100%);
    border: 1px solid var(--stilaro-border);
    border-radius: var(--stilaro-radius-lg);
    padding: clamp(16px, 4vw, 20px);
    margin-bottom: clamp(12px, 3vw, 16px);
    text-align: center;
  }

  .stilaro-sizing-result-header {
    margin-bottom: clamp(12px, 3vw, 16px);
  }

  .stilaro-sizing-result-header .sizing-result-icon {
    font-size: clamp(28px, 7vw, 32px);
    display: block;
    margin-bottom: clamp(6px, 1.5vw, 8px);
  }

  .stilaro-sizing-result-header h3 {
    margin: 0;
    font-size: clamp(14px, 3.5vw, 16px);
    font-weight: 600;
    color: var(--stilaro-text);
  }

  .stilaro-sizing-recommended {
    margin-bottom: clamp(16px, 4vw, 20px);
  }

  .sizing-main-size {
    display: block;
    font-size: clamp(40px, 10vw, 48px);
    font-weight: 700;
    color: var(--stilaro-primary);
    line-height: 1;
    margin-bottom: clamp(6px, 1.5vw, 8px);
  }

  .sizing-alt-size {
    display: block;
    font-size: clamp(12px, 3vw, 13px);
    color: var(--stilaro-text-muted);
  }

  .stilaro-sizing-confidence {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: clamp(8px, 2vw, 10px);
    margin-bottom: clamp(12px, 3vw, 16px);
    padding: clamp(8px, 2vw, 10px);
    background: var(--stilaro-bg);
    border-radius: var(--stilaro-radius-md);
    flex-wrap: wrap;
  }

  .confidence-label {
    font-size: clamp(11px, 2.8vw, 12px);
    color: var(--stilaro-text-muted);
  }

  .confidence-bar {
    width: clamp(60px, 15vw, 80px);
    height: 6px;
    background: var(--stilaro-gray-200);
    border-radius: 3px;
    overflow: hidden;
  }

  .confidence-fill {
    height: 100%;
    background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
    border-radius: 3px;
    transition: width 0.5s ease;
  }

  .confidence-fill.medium {
    background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
  }

  .confidence-fill.low {
    background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
  }

  .confidence-text {
    font-size: clamp(11px, 2.8vw, 12px);
    font-weight: 600;
    color: #22c55e;
  }

  .confidence-text.medium {
    color: #d97706;
  }

  .confidence-text.low {
    color: #dc2626;
  }

  .stilaro-sizing-details {
    text-align: left;
    font-size: clamp(11px, 2.8vw, 12px);
    color: var(--stilaro-text-muted);
    padding: clamp(10px, 2.5vw, 12px);
    background: var(--stilaro-bg);
    border-radius: var(--stilaro-radius-md);
    margin-bottom: clamp(10px, 2.5vw, 12px);
  }

  .stilaro-sizing-details p {
    margin: 0 0 clamp(4px, 1vw, 6px) 0;
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 4px;
  }

  .stilaro-sizing-details p:last-child {
    margin-bottom: 0;
  }

  .stilaro-sizing-details strong {
    color: var(--stilaro-text);
  }

  .stilaro-sizing-tip {
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    border: 1px solid #fcd34d;
    border-left: 3px solid #f59e0b;
    padding: clamp(8px, 2vw, 10px) clamp(10px, 2.5vw, 12px);
    border-radius: 0 var(--stilaro-radius-sm) var(--stilaro-radius-sm) 0;
    font-size: clamp(11px, 2.8vw, 12px);
    line-height: 1.4;
    color: #92400e;
    text-align: left;
  }

  .stilaro-sizing-tip::before {
    content: "ðŸ’¡ ";
  }

  /* ==================== */
  /* RESPONSIVE: MOBILE (<480px) */
  /* ==================== */
  @media screen and (max-width: 480px) {
    .stilaro-vton-modal-content {
      width: calc(100% - 16px) !important;
      max-height: calc(100vh - 24px) !important;
      max-height: calc(100dvh - 24px) !important;
      border-radius: var(--stilaro-radius-lg) !important;
    }

    .stilaro-vton-header {
      padding-right: 32px;
    }

    .stilaro-tab {
      padding: 10px 6px;
      font-size: 11px;
    }

    .stilaro-vton-actions {
      flex-direction: column;
    }

    .stilaro-vton-actions .stilaro-vton-secondary-btn {
      width: 100%;
      order: 1;
    }

    .stilaro-vton-actions .stilaro-vton-primary-btn {
      order: 0;
    }

    .stilaro-recommendations-actions {
      flex-direction: column;
      gap: 8px;
    }

    .stilaro-recommendations-actions .stilaro-vton-secondary-btn {
      width: 100%;
      order: 1;
    }

    .stilaro-recommendations-actions .stilaro-vton-primary-btn {
      width: 100%;
      order: 0;
    }

    .stilaro-recommendation-items {
      justify-content: flex-start;
      padding-left: 4px;
    }

    .stilaro-sizing-options {
      gap: 4px;
    }

    .stilaro-sizing-option {
      min-width: 55px;
      max-width: 80px;
      padding: 8px 4px;
    }

    .stilaro-sizing-sizes .stilaro-sizing-option {
      min-width: 36px;
      max-width: 48px;
      padding: 8px 4px;
    }
  }

  /* ==================== */
  /* RESPONSIVE: SMALL MOBILE (<360px) */
  /* ==================== */
  @media screen and (max-width: 360px) {
    .stilaro-vton-modal-content {
      padding: 12px !important;
    }

    .stilaro-vton-header h2 {
      font-size: 16px;
    }

    .stilaro-tab {
      padding: 8px 4px;
      font-size: 10px;
    }

    .stilaro-vton-product-preview {
      padding: 8px;
      gap: 8px;
    }

    .stilaro-vton-product-preview img {
      width: 45px;
      height: 45px;
    }

    .stilaro-vton-upload-area {
      padding: 20px 12px;
    }

    .stilaro-recommendation-item {
      flex: 0 0 75px;
    }

    .sizing-main-size {
      font-size: 36px;
    }
  }

  /* ==================== */
  /* RESPONSIVE: TABLET (481px - 768px) */
  /* ==================== */
  @media screen and (min-width: 481px) and (max-width: 768px) {
    .stilaro-vton-modal-content {
      max-width: 520px !important;
    }

    .stilaro-vton-modal.outfit-mode .stilaro-vton-modal-content {
      max-width: 600px !important;
    }

    .stilaro-recommendation-items {
      justify-content: center;
    }
  }

  /* ==================== */
  /* RESPONSIVE: DESKTOP (>768px) */
  /* ==================== */
  @media screen and (min-width: 769px) {
    .stilaro-vton-modal-content {
      max-height: 85vh !important;
    }

    .stilaro-vton-modal.outfit-mode .stilaro-vton-modal-content {
      max-width: 640px !important;
    }

    .stilaro-recommendation-items {
      justify-content: center;
      flex-wrap: wrap;
    }

    .stilaro-recommendation-item {
      flex: 0 0 110px;
    }
  }

  /* ==================== */
  /* LANDSCAPE MODE */
  /* ==================== */
  @media screen and (max-height: 500px) and (orientation: landscape) {
    .stilaro-vton-modal-content {
      max-height: calc(100vh - 20px) !important;
      max-height: calc(100dvh - 20px) !important;
    }

    #stilaro-user-preview,
    #stilaro-outfit-user-preview,
    #stilaro-sizing-user-preview {
      max-height: 150px;
    }

    .stilaro-vton-result img {
      max-height: 200px;
    }

    .stilaro-vton-spinner {
      margin: 20px auto;
    }

    .stilaro-recommendations-grid {
      max-height: 150px;
    }
  }

  /* ==================== */
  /* HIGH DPI DISPLAYS */
  /* ==================== */
  @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .stilaro-vton-modal-content {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
  }

  /* ==================== */
  /* REDUCED MOTION */
  /* ==================== */
  @media (prefers-reduced-motion: reduce) {
    .stilaro-vton-spinner {
      animation: none;
    }

    .stilaro-vton-modal-content,
    .stilaro-tab,
    .stilaro-vton-primary-btn,
    .stilaro-vton-secondary-btn,
    .stilaro-recommendation-item,
    .stilaro-sizing-option {
      transition: none;
    }
  }

  /* ==================== */
  /* SAFE AREA (notch devices) */
  /* ==================== */
  @supports (padding: max(0px)) {
    .stilaro-vton-modal-content {
      padding-left: max(clamp(16px, 4vw, 24px), env(safe-area-inset-left)) !important;
      padding-right: max(clamp(16px, 4vw, 24px), env(safe-area-inset-right)) !important;
      padding-bottom: max(clamp(16px, 4vw, 24px), env(safe-area-inset-bottom)) !important;
    }
  }

  /* ==================== */
  /* FASHION TIPS ANIMATION */
  /* ==================== */
  .stilaro-fashion-tips {
    margin-top: clamp(20px, 5vw, 28px);
    padding: clamp(14px, 3.5vw, 18px);
    background: linear-gradient(135deg, #fdf4ff 0%, #fae8ff 50%, #f5d0fe 100%);
    border-radius: var(--stilaro-radius-lg);
    border: 1px solid #e879f9;
    position: relative;
    overflow: hidden;
  }

  .stilaro-fashion-tips::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 200%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(255, 255, 255, 0.4) 50%,
      transparent 100%
    );
    animation: stilaro-shimmer 2.5s infinite;
  }

  @keyframes stilaro-shimmer {
    0% { transform: translateX(0); }
    100% { transform: translateX(50%); }
  }

  .fashion-tip-container {
    display: flex;
    align-items: flex-start;
    gap: clamp(10px, 2.5vw, 12px);
    position: relative;
    z-index: 1;
  }

  .fashion-tip-icon {
    font-size: clamp(20px, 5vw, 24px);
    flex-shrink: 0;
    animation: stilaro-pulse 2s ease-in-out infinite;
  }

  @keyframes stilaro-pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.8; }
  }

  .fashion-tip-text {
    margin: 0;
    font-size: clamp(12px, 3vw, 14px);
    color: #86198f;
    line-height: 1.5;
    font-weight: 500;
    animation: stilaro-fade-in 0.5s ease-out;
  }

  @keyframes stilaro-fade-in {
    0% {
      opacity: 0;
      transform: translateY(8px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .fashion-tip-text.fade-out {
    animation: stilaro-fade-out 0.3s ease-in forwards;
  }

  @keyframes stilaro-fade-out {
    0% {
      opacity: 1;
      transform: translateY(0);
    }
    100% {
      opacity: 0;
      transform: translateY(-8px);
    }
  }

  /* Variantes de iconos para diferentes tips */
  .fashion-tip-icon.tip-color { content: 'ðŸŽ¨'; }
  .fashion-tip-icon.tip-style { content: 'ðŸ‘—'; }
  .fashion-tip-icon.tip-trend { content: 'ðŸ”¥'; }
  .fashion-tip-icon.tip-advice { content: 'ðŸ’¡'; }

  /* Responsive adjustments */
  @media screen and (max-width: 480px) {
    .stilaro-fashion-tips {
      margin-top: 16px;
      padding: 12px;
    }

    .fashion-tip-text {
      font-size: 12px;
    }
  }

  /* Dark theme detection - adaptive to actual page colors */
  @media (prefers-color-scheme: dark) {
    .stilaro-vton-modal {
      /* Override for browsers that support prefers-color-scheme but theme doesn't provide vars */
      --stilaro-bg: var(--color-background, var(--color-base-background-1, #1a1a1a));
      --stilaro-text: var(--color-foreground, var(--color-base-text, #e5e5e5));
    }

    .stilaro-fashion-tips {
      background: linear-gradient(135deg, #581c87 0%, #701a75 50%, #86198f 100%);
      border-color: #c026d3;
    }

    .fashion-tip-text {
      color: #fae8ff;
    }
  }

  /* JS-detected dark theme class (for themes that don't use prefers-color-scheme) */
  .stilaro-vton-modal.stilaro-dark-theme .stilaro-fashion-tips {
    background: linear-gradient(135deg, #581c87 0%, #701a75 50%, #86198f 100%);
    border-color: #c026d3;
  }

  .stilaro-vton-modal.stilaro-dark-theme .fashion-tip-text {
    color: #fae8ff;
  }

  /* Ensure images don't get inverted in dark themes */
  .stilaro-vton-modal img {
    color-scheme: light;
  }
</style>

<script src="{{ 'vton-modal.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Probador Virtual",
  "target": "section",
  "enabled_on": {
    "templates": ["product"]
  },
  "settings": [
    {
      "type": "header",
      "content": "BotÃ³n"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Texto del botÃ³n",
      "default": "Probar virtualmente"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Color de fondo",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Color del texto",
      "default": "#FFFFFF"
    },
    {
      "type": "range",
      "id": "button_padding",
      "label": "Padding",
      "min": 8,
      "max": 24,
      "step": 2,
      "default": 14,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Bordes redondeados",
      "min": 0,
      "max": 30,
      "step": 2,
      "default": 8,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "TamaÃ±o de fuente",
      "min": 12,
      "max": 20,
      "step": 1,
      "default": 14,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Ancho completo",
      "default": true
    },
    {
      "type": "header",
      "content": "Espaciado"
    },
    {
      "type": "range",
      "id": "margin_top",
      "label": "Margen superior",
      "min": 0,
      "max": 40,
      "step": 4,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "label": "Margen inferior",
      "min": 0,
      "max": 40,
      "step": 4,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Modal"
    },
    {
      "type": "text",
      "id": "modal_title",
      "label": "TÃ­tulo del modal",
      "default": "Probador Virtual"
    },
    {
      "type": "text",
      "id": "modal_subtitle",
      "label": "SubtÃ­tulo",
      "default": "Sube una foto tuya para ver cÃ³mo te queda"
    }
  ]
}
{% endschema %}
